---
title: '뽀모닭 개발기 2편 - 네이티브 앱을 흉내내는 프론트 이야기(2)'
description: 설명
slug: pomodak-dev-story-2
date: 2024-03-18
excerpt: 나도 앱이랑 똑같이 동작하고 싶어.. 불쌍한 pwa앱 이야기
tags:
  - 🐥Pomodak
  - Project
published: true
---

오늘은 뽀모닭 개발기 프론트 2편을 준비해 보았습니다.

FCM이나 소켓 통신 같은 기능은 다른 편에서 다루고

이번 글에선 `pwa앱`의 한계와 시행착오, 극복하는 방법등을 다뤄보겠습니다.

## PWA가 뭘까?

프로그레시브 웹 앱(Progressive Web Apps)은 웹 앱과 네이티브 앱의 장점을 모두 제공하는 웹 어플리케이션 입니다.

뛰어난 접근성이 장점이고 오프라인에서 동작, 설치가 가능, 쉬운 동기화, 푸시 알림, 카메라, 마이크 등을 이용할 수 있다는 장점이 있습니다.

하지만 네이티브앱처럼 모바일 기기OS에서 제공하는 기능을 이용하는데 있어 제한적이다는 단점이 존재합니다.

하지만 차이점을 매꾸고 잘 구현한다면 사용자에게 앱과 완전히 동일한 경험을 제공할 수 있습니다.

`PWA앱`과 `Manifest`, `Service Worker` 등에 대한 자세한 내용은 다른 글들을 참고해주세요.

## 매꿔야할 차이점

1. 각 기기마다 상단바나 하단바로 인해 UI가 가려지는 문제가

2. 드래그, 이미지 `context-menu`(우클릭, 꾹클릭) 막기, 텍스트 선택 막기  
   앱처럼 동작하기 위해서는 브라우저의 일부 기능을 막아야합니다.  
   `pwa`가 기기에 설치되더라도 완전한 브라우저 기반이기 때문에 브라우저의 동작들을 모두 가지고있습니다.

3. 히스토리(뒤로가기) 제어  
   히스토리는 만드려는 서비스의 특징을 기준으로 생각해야합니다.

   보통 브라우저의 상단 url표시줄을 감추는 `standalone` 모드나 `fullscreen`을 사용하기 때문에 뒤로가기 동작을 꼼꼼하게 테스트하고 제어를 해야합니다.

4. 새로고침 문제  
   `standalone` 모드에선 url표시줄이 없기 때문에 서비스 특성에 따라 `pull to refresh`나 새로고침 버튼 등을 구현해야합니다.

5. 가로모드/세로모드 꼼꼼히 확인 (orientation)
   빌드할때 매니페스트에 꼭 orientation 설정이 잘 되어있나 확인해주세요.

   세로모드: portrait, 가로모드: landscape

   pwa앱을 네이티브 스토어에 출시할 때 매니페스트를 수정하려면 새로 빌드 후 배포해야합니다.

6. 푸시 알림 구현  
    브라우저는 `Notification API`를 사용하여 기기에 알림을 보낼 수 있습니다.  
    따라서 앱이 켜져있을때는 앱에서 직접 `Notification API`을 호출하여 알림을 보낼 수 있지만 백그라운드에서 알림을 보낼려면 추가적인 조치가 필요합니다.

   - 푸시 메세지를 받을 수 있는 `service-worker`를 생성
   - `pwa앱`이 푸시 서버에서 토큰을 발급 후 백엔드로 전송
   - 백엔드에서 푸시서버에 해당 토큰과 내용을 발송

7. `pwa`은 기기의 `기본 브라우저`로 설정된 브라우저를 통해 실행됩니다.
   이에 따라 푸시알림의 icon이나 8, 9번 문제와 같이 예상치 못한 문제들이 종종 발생합니다.  
   안드로이드의 경우 초기 세팅인 `삼성 브라우저`가 되어있을 확률이 매우 큽니다. (문제도 많고, 고치기도 힘든 녀석)
   따라서 코드로 해결하지 못하는 문제들은 적절한 안내가 필요합니다.

8. 삼성 브라우저 다크모드 문제
   삼성 브라우저는 자체적인 다크모드 알고리즘을 가지고 있습니다.  
   따라서 삼성 브라우저의 다크모드가 켜져있으면 일반적인 prefer-color-schema를 무시하고 자체적인 다크모드 스타일을 적용시켜버립니다.

   따라서 삼성브라우저 -> 설정 -> 웹사이트 다크 테마 사용을 체크해야 구현된 스타일대로 동작하게 됩니다.

9. 핀치 줌 제어를 막고 있는 추세(확대, 축소)
   이전에는 html의 meta 태그를 통해 핀치 줌을 막을 수 있었습니다.

   ```html
   <meta
     name="viewport"
     content="width=device-width,initial-scale=1.0,user-scalable=no"
   />
   ```

   하지만 최근에는 반드시 확대가 필요한 유저들의 경험을 해칠 수 있어 safari는 물론 삼성 브라우저 및 여러 브라우저에서도 제어가 불가능하도록 변하는 중입니다.

   따라서 권장하진 않지만 js 코드를 통해 핀치 줌 여부를 판단하여 이벤트를 막아야합니다.

   ```tsx
   React.useEffect(() => {
     const preventZoom = () => (event: TouchEvent) => {
       // 핀치 줌의 경우 두 개 이상의 이벤트가 발생
       if (event.touches.length > 1) {
         event.preventDefault();
       }
     };
     document.addEventListener('touchmove', preventZoom, { passive: false });
     return () => {
       document.removeEventListener('touchmove', preventZoom);
     };
   }, []);
   ```

   하지만 위 방법도 삼성 브라우저에서는 먹히지 않습니다.

   왜냐하면 다크모드처럼 자체의 핀트줌 기능을 사용하는 것으로 추측됩니다.

   따라서 삼성브라우저 -> 설정 -> 손가락으로 웹페이지 확대/축소 기능을 해제해야 기본 사이트의 동작을 따르게 됩니다.

## UI 문제 해결

작성중...

### 안전영역(safe-area) 고려

tialwind plugin

### 스크롤바 제거 or 디자인 수정, 드래그 & 우클릭 & 텍스트 선택 막기

css, <head/>

## UX 문제 해결

### 히스토리 제어

replace 사용

### 모바일 종료 구현

pwa 앱이 종료되는 조건
해결법

## 마무리

PWA 빌더가 브라우저의 주소창은 없애주지만 브라우저의 동작은 막아주지 않습니다.

또한 app으로 빌드되었을때 스토어에 승인되어 올라가지 않는 한 종료할때 잠깐 브라우저의 모습이 보이게됩니다.

따라서 위에서 언급한 내용 이외에도 고려할 부분이 매우 많기 때문에 네이티브 앱과 꾸준히 비교하면서 차이를 매꾸는게 중요한 것 같습니다.

FCM을 통한 푸시알림 내용은 양이 많음으로 다른 포스팅에서 다뤄보겠습니다.
