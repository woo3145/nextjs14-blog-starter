---
title: 'ë½€ëª¨ë‹­ ê°œë°œê¸° 8í¸ - í”ŒëŸ¬í„°ê°€ ë§í•œë‹¤ê³ ? Flutter ì „í™˜ê¸° (2)'
description: ë¼ìš°íŒ… ë° íƒ€ì´ë¨¸ êµ¬í˜„
date: '2024-05-03'
image: 'https://d2quahb2ygxiv.cloudfront.net/f543bea9849fb3a9d6b6b.png'
authors:
  - woo3145
tags:
  - ğŸ¥Pomodak
  - Project
  - Flutter
  - Mobile
published: false
---

ìµœê·¼ í”ŒëŸ¬í„° íŒ€ì´ ëŒ€ê·œëª¨ í•´ê³ ë¥¼ ë‹¹í•´ì„œ í”ŒëŸ¬í„°ê°€ ë²„ë ¤ì§„ë‹¤ëŠ” ì†Œë¬¸ì´ ëŒê³ ìˆìŠµë‹ˆë‹¤.

ì´ì—ë”°ë¼ í”„ë¡œë•íŠ¸ ë§¤ë‹ˆì € [Michael Thomsenì´ ì•„ë˜ì™€ ê°™ì€ íŠ¸ìœ—](https://twitter.com/walkingriver/status/1786041534455980225)ì„ ë‚¨ê²¼ìŠµë‹ˆë‹¤.

![image](https://d2quahb2ygxiv.cloudfront.net/543bea9849fb3a9d6b6b2.png)

ëª‡ì‹œê°„ì „ ëŒ“ê¸€ì—ì„œ í”ŒëŸ¬í„° ê°œë°œìë¥¼ ì±„ìš©í•  ì˜ˆì •ì´ë¼ê³  ë°íŒ ê²ƒì„ ë³´ë©´ í”ŒëŸ¬í„°ê°€ ë²„ë ¤ì§„ë‹¤ëŠ” ì†Œë¬¸ì€ ì‚¬ì‹¤ì´ ì•„ë‹Œ ê²ƒ ê°™ìŠµë‹ˆë‹¤.

ê·¸ì € êµ¬ê¸€ì˜ ì „ì²´ì ì¸ êµ¬ì¡°ì¡°ì •ì¤‘ í”ŒëŸ¬í„°íŒ€ë„ ê·¸ì— ë”°ë¥¸ êµ¬ì¡°ì¡°ì •ì´ ìˆë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤.

ê·¸ë˜ë„ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë‚˜ í”„ë ˆì„ì›Œí¬ëŠ” ì–¸ì œë“ ì§€ ì‚¬ë¼ì§ˆ ìˆ˜ë„ ìˆê³ , ìƒˆë¡œìš´ ê¸°ìˆ ì´ ë‚˜ì˜¤ê¸°ë„ í•˜ë‹ˆ ê·¸ì € í˜„ì¬ì˜ ê¸°ìˆ ì„ ì˜ í™œìš©í•˜ê³  ë¹ ë¥´ê²Œ ì ì‘í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•œ ê²ƒ ê°™ìŠµë‹ˆë‹¤.

ê·¸ëŸ¼ ì´ì œ ë³¸ê²©ì ìœ¼ë¡œ ë½€ëª¨ë‹­ ì´ì•¼ê¸°ë¥¼ ì‹œì‘í•´ë³´ê² ìŠµë‹ˆë‹¤.

## ë¼ìš°íŒ… êµ¬í˜„

í”ŒëŸ¬í„°ì—ì„œ ë¼ìš°íŒ…ì€ `Navigator ìœ„ì ¯`ì—ì„œ ê´€ë¦¬í•©ë‹ˆë‹¤. ìŠ¤íƒ êµ¬ì¡°ë¡œ ë˜ì–´ìˆì–´ì„œ `push`, `pop`ì„ í†µí•´ í™”ë©´ì„ ì „í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë³´í†µ `Widget.of(context)`ëŠ” ìƒìœ„ì—ì„œ ê°€ì¥ ê°€ê¹Œìš´ ìœ„ì ¯ì„ ì°¾ì•„ì£¼ëŠ” ì—­í• ì„ í•˜ëŠ”ë° ì´ë¥¼ ì´ìš©í•´ ê°€ì¥ ê°€ê¹Œìš´ Navigatorë¥¼ ì°¾ì•„ ë¼ìš°íŒ…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- `Navigator.of(context).push('/route')` or `Navigator.push(context, '/route')`
- `Navigator.of(context).pop()` or `Navigator.pop(context)`

- ì¶”ê°€ë¡œ `Navigator.of(context, rootNavigator: true)`ë¥¼ ì‚¬ìš©í•˜ë©´ ìµœìƒë‹¨ì˜ Navigatorë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### go_router íŒ¨í‚¤ì§€ ì‚¬ìš©

ì œê°€ ì›í•˜ëŠ” ë¼ìš°íŒ… ë™ì‘ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

- `splash í™”ë©´`ì—ì„œ í•„ìˆ˜ ì´ˆê¸° ë°ì´í„° ë¡œë”©
- ë¼ìš°í„°ê°€ `viewModel`ì„ í†µí•´ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ê°ì§€í•˜ê³  ì´ì— ë”°ë¼ í™”ë©´ ì „í™˜
- ìƒíƒœì— ë”°ë¼ ë¦¬ë‹¤ì´ë ‰íŠ¸(ì´ˆê¸°í™”ê°€ ì•ˆë˜ì—ˆì„ë•Œ ë‹¤ë¥¸ ë¼ìš°í„° ì ‘ê·¼, ë¡œê·¸ì¸ëœ ìƒíƒœì—ì„œ ë¡œê·¸ì¸ í˜ì´ì§€ ì ‘ê·¼ ë“±)

Navigatorë¥¼ ì‚¬ìš©í•˜ë©´ ë§ì´ ë³µì¡í•´ì§€ê¸° ë•Œë¬¸ì— ì´ë¥¼ ì¢€ë” ê°„í¸í•˜ê²Œ ê´€ë¦¬í•˜ê¸° ìœ„í•´ `go_router` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.

`go_router`ëŠ” ê¸°ì¡´ Navigatorì™€ ë‹¬ë¦¬ URL ê¸°ë°˜ì˜ ë¼ìš°íŒ…ì„ ì§€ì›í•˜ëŠ” íŒ¨í‚¤ì§€ì…ë‹ˆë‹¤.

ì œì¼ ìì£¼ ì‚¬ìš©ë˜ëŠ” ë©”ì„œë“œëŠ” ë‹¤ìŒ 3ê°€ì§€ ì…ë‹ˆë‹¤.

- `context.go('/route')` : í•´ë‹¹ ê²½ë¡œë¡œ ì´ë™
- `context.push('/route')` : í•´ë‹¹ ê²½ë¡œë¡œ ì´ë™í•˜ê³  ì´ì „ ê²½ë¡œë¥¼ ìŠ¤íƒì— ì €ì¥
- `context.pop()` : ì´ì „ ê²½ë¡œë¡œ ì´ë™

[go_routerì˜ ë¬¸ì„œ](https://pub.dev/documentation/go_router/latest/go_router/go_router-library.html)ì—ì„œ ì—¬ëŸ¬ ë©”ì„œë“œ ì‚¬ìš©ë²•ì„ ì°¾ê¸° êµ‰ì¥íˆ ì–´ë µê¸° ë–„ë¬¸ì— `Command + í´ë¦­`ì„ í†µí•´ í•„ìš”í•œ ë©”ì„œë“œë¥¼ ì°¾ëŠ” ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤.

### providerì™€ go_routerë¥¼ í†µí•œ ë¼ìš°íŒ… êµ¬í˜„

ë¼ìš°íŒ…ì„ ìœ„í•œ `AppRouter` í´ë˜ìŠ¤ì˜ ì „ì²´ì ì¸ êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```dart
GlobalKey<NavigatorState> navigatorKey = GlobalKey<NavigatorState>();

class AppRouter {
  final AppViewModel appViewModel;
  final AuthViewModel authViewModel;
  late final GoRouter _goRouter;

  AppRouter({required this.appViewModel, required this.authViewModel}) {
    _goRouter = _initGoRouter();
  }

  GoRouter get router => _goRouter;

  GoRouter _initGoRouter() {
    return GoRouter(
      refreshListenable: Listenable.merge([appViewModel, authViewModel]),
      initialLocation: AppPage.splash.toPath,
      routes: _getRoutes(),
      errorBuilder: (context, state) =>
          ErrorPage(error: state.error.toString()),
      redirect: _redirectLogic,
      navigatorKey: navigatorKey,
    );
  }

  List<GoRoute> _getRoutes() {
    return [
      GoRoute(
        path: AppPage.home.toPath,
        name: AppPage.home.toName,
        builder: (context, state) => const MyHomePage(),
      ),
      GoRoute(
        path: AppPage.splash.toPath,
        name: AppPage.splash.toName,
        builder: (context, state) => const SplashPage(),
      ),
        // ...
    ];
  }

  String? _redirectLogic(BuildContext context, GoRouterState state) {
    final isLoggedIn = authViewModel.isLoggedIn;
    final isInitialized = appViewModel.initialized;

    final locations = {
        // ...
      'login': state.namedLocation(AppPage.login.toName),
      'home': state.namedLocation(AppPage.home.toName),
      'splash': state.namedLocation(AppPage.splash.toName),
    };

    if (!isInitialized && state.matchedLocation != locations['splash']) {
      return locations['splash'];
    }

    if ((isLoggedIn &&
            (state.matchedLocation == locations['login'] ||
                state.matchedLocation == locations['welcome'] ||
                state.matchedLocation == locations['register'])) ||
        (isInitialized && state.matchedLocation == locations['splash'])) {
      return locations['home'];
    }
    // ...

    return null;
  }
}

```

#### viewModelì„ í†µí•œ ìƒíƒœ ê°ì§€

ë¨¼ì € ë¼ìš°í„°ê°€ ê°ì§€í•´ì•¼í•  ìƒíƒœëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

- `appViewModel` : ì•±ì˜ ì´ˆê¸°í™” ì—¬ë¶€
- `authViewModel` : ë¡œê·¸ì¸ ì—¬ë¶€(jwt í† í°ì´ ì¡´ì¬í•˜ëŠ”ì§€)

goRouterì—ì„  `refreshListenable`ì„ í†µí•´ ë¦¬ìŠ¤ë„ˆë¥¼ ë“±ë¡í•  ìˆ˜ ìˆê³  mergeë¥¼ í†µí•´ ì—¬ëŸ¬ê°œì˜ ë¦¬ìŠ¤ë„ˆë¥¼ ë“±ë¡í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

```dart
// app_router.dart

AppRouter({required this.appViewModel, required this.authViewModel}) {
    _goRouter = _initGoRouter();
}

GoRouter _initGoRouter() {
    return GoRouter(
        refreshListenable: Listenable.merge([appViewModel, authViewModel]),
        // ...
    );
}

// main.dart
final appRouter = AppRouter(
    appViewModel: getIt<AppViewModel>(),
    authViewModel: getIt<AuthViewModel>());
final goRouter = appRouter.router;

MaterialApp.router(
    // ...
    routerConfig: goRouter,
)
```

#### redirect ì²˜ë¦¬

ì´ì œ providerë¥¼ í†µí•´ ìƒíƒœë¥¼ ê°ì§€í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìœ¼ë‹ˆ ì´ë¥¼ í†µí•´ ë¦¬ë‹¤ì´ë ‰íŠ¸ ë¡œì§ì„ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`locations`ì—ì„œ ì´ë™í•˜ë ¤ëŠ” í˜ì´ì§€ì˜ ê²½ë¡œë¥¼ ë¯¸ë¦¬ ì €ì¥í•´ë‘ê³ , `state.matchedLocation`ì„ í†µí•´ í˜„ì¬ ìœ„ì¹˜ì™€ ë¹„êµí•˜ì—¬ í•´ë‹¹ í˜ì´ì§€ë¡œ ì´ë™í•˜ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ˆê¸°í™” & ë¡œê·¸ì¸ ì—¬ë¶€ì™€ ê²°í•©í•˜ì—¬ ì ì ˆí•œ ë¦¬ë‹¤ì´ë ‰íŠ¸ë¥¼ í†µí•´ ì ‘ê·¼ì„ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```dart
// app_router.dart

String? _redirectLogic(BuildContext context, GoRouterState state) {
    final isLoggedIn = authViewModel.isLoggedIn;
    final isInitialized = appViewModel.initialized;

    final locations = {
        // ...
      'login': state.namedLocation(AppPage.login.toName),
      'home': state.namedLocation(AppPage.home.toName),
      'splash': state.namedLocation(AppPage.splash.toName),
    };

    // ì´ˆê¸°í™”ê°€ ë˜ì§€ ì•Šì•˜ì„ë•Œ ë¬´ì¡°ê±´ splash í˜ì´ì§€ë¡œ ì´ë™
    if (!isInitialized) {
      return locations['splash'];
    }

    // ë¡œê·¸ì¸ì´ ë˜ì–´ìˆëŠ”ë° ë¡œê·¸ì¸ ê´€ë ¨ í˜ì´ì§€ë¡œ ì ‘ê·¼í•˜ê±°ë‚˜ ì´ˆê¸°í™”ê°€ ì´ë¯¸ ì™„ë£Œë˜ì—ˆëŠ”ë° splash í˜ì´ì§€ë¡œ ì ‘ê·¼í•˜ë©´ home í˜ì´ì§€ë¡œ ì´ë™
    if ((isLoggedIn &&
            (state.matchedLocation == locations['login'] ||
                state.matchedLocation == locations['welcome'] ||
                state.matchedLocation == locations['register'])) ||
        (isInitialized && state.matchedLocation == locations['splash'])) {
      return locations['home'];
    }
    // ... ë‹¤ì–‘í•œ ìƒí™© ì²˜ë¦¬

    return null;
}
```
