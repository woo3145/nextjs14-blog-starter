---
title: 'ë½€ëª¨ë‹­ ê°œë°œê¸° 7í¸ - React+ PWAì—ì„œ Flutter ì „í™˜ê¸° (1)'
description: í•œë‹¬ë§Œì— Dart í•™ìŠµë¶€í„° Flutter í”Œë ˆì´ìŠ¤í† ì–´ ë°°í¬ê¹Œì§€ ëë‚´ê¸°
date: '2024-04-28'
image: 'https://d2quahb2ygxiv.cloudfront.net/f543bea9849fb3a9d6b6b.png'
authors:
  - woo3145
tags:
  - ğŸ¥Pomodak
  - Project
  - Flutter
  - Mobile
published: true
---

![alt text](https://d2quahb2ygxiv.cloudfront.net/f543bea9849fb3a9d6b6b.png?width=1200)

ë½€ëª¨ë‹­ì„ í”ŒëŸ¬í„°ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ë©´ì„œ ê²ªì€ ê³¼ì •ì„ ê³µìœ í•©ë‹ˆë‹¤.

ì¼ì£¼ì¼ì •ë„ ì¼ë•Œë¬¸ì— ì‘ì—…ì„ ê±°ì˜ ëª»í•´ì„œ ì‹¤ì œ ì‘ì—…ì€ 3ì£¼ ì •ë„ ê±¸ë¦° ê²ƒ ê°™ìŠµë‹ˆë‹¤.

ë¦¬ì•¡íŠ¸ ë„¤ì´í‹°ë¸Œì™€ í”ŒëŸ¬í„° ì¤‘ ì—„ì²­ ê³ ë¯¼í–ˆëŠ”ë°, í”ŒëŸ¬í„°ë¥¼ ì„ íƒí•œê²Œ ì •ë§ ë§Œì¡±ìŠ¤ëŸ¬ì› ìŠµë‹ˆë‹¤.

PWAë¥¼ ë°°í¬í•˜ë©´ì„œ ì•ˆë“œë¡œì´ë“œ ì¸ì¦ì„œ(signing.keystore)ë¥¼ ìƒì„±í–ˆì—ˆëŠ”ë°, ì´ë¯¸ í•´ë‹¹ ì¸ì¦ì„œë¡œ ì„œëª…ëœ ì•±ì„ ë°°í¬í–ˆê¸° ë•Œë¬¸ì— í”ŒëŸ¬í„°ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ë©´ì„œ í•´ë‹¹ ì¸ì¦ì„œë¥¼ ì‚¬ìš©í•˜ì—¬ ë²„ì „ì—…ì„ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.

ì•„ë¬´ë˜ë„ ë„¤ì´í‹°ë¸Œ ì•± ê°œë°œì´ ì²˜ìŒì´ë¼ iOSì™€ ì•ˆë“œë¡œì´ë“œì˜ í™˜ê²½ê³¼ ë¹Œë“œ ê³¼ì • ë“±ì— ì‹œê°„ì„ ì¢€ë” íˆ¬ìí•œ ê²ƒ ê°™ìŠµë‹ˆë‹¤.

í¬ë¡œìŠ¤ í”Œë«í¼ ì•±ê°œë°œì„ ê³ ë ¤í• ë•Œ ë¦¬ì•¡íŠ¸ ê²½í—˜ ë•Œë¬¸ì— ë¦¬ì•¡íŠ¸ ë„¤ì´í‹°ë¸Œë¡œ ë°”ë¡œ ê²°ì •í•˜ê¸° ë³´ë‹¤ í”ŒëŸ¬í„°ë„ í•œë²ˆ ê³ ë ¤í•  ë§Œí•œ ê°€ì¹˜ê°€ í¬ë‹¤ê³  ëŠê¼ˆìŠµë‹ˆë‹¤.

iOSëŠ” ì•±ìŠ¤í† ì–´ ê°œë°œì ê³„ì •ë“±ë¡ì´ ìƒë‹¹íˆ ì˜¤ë˜ê±¸ë¦¬ë„¤ìš”. ì‹ ë¶„ì¦ í™•ì¸ë§Œ ìµœëŒ€ 3ì£¼ê¹Œì§€ ê±¸ë¦°ë‹¤ê³  í•´ì„œ iOSëŠ” ì´í›„ì— ë°°í¬ë¥¼ ì§„í–‰í•´ì•¼ í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤.

## ì‘ì—… ê¸°ê°„

3ì›” 24ì¼ ì‹œì‘ ~ 4ì›” 24ì¼ ë°°í¬ ì™„ë£Œ

dart í•™ìŠµë¶€í„° êµ¬ê¸€ í”Œë ˆì´ ìŠ¤í† ì–´ ë°°í¬ê¹Œì§€ ë”± í•œë‹¬ì´ ê±¸ë ¸ë„¤ìš”.

ì‘ì—…ì€ ëŒ€ëµì ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì´ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.

- 1ì¼ì°¨ - dartì–¸ì–´ í•™ìŠµ & í”ŒëŸ¬í„° í”„ë¡œì íŠ¸ ìƒì„±

- 2 ~ 3ì¼ì°¨ - ì˜¤ì§ UI ì‘ì—…ë§Œ ì§„í–‰í•˜ë©´ì„œ dartì™€ flutterì— ìµìˆ™í•´ì§€ê¸°

- 4ì¼ì°¨ - ìƒíƒœê´€ë¦¬ ë°©ì‹ ì¡°ì‚¬ & Providerë¡œ ìƒíƒœê´€ë¦¬ ì ìš©

- 5ì¼ì°¨ - API ì²˜ë¦¬ë°©ì‹ ì¡°ì‚¬ (http íŒ¨í‚¤ì§€ ì ìš©) & ë¡œì»¬ ì €ì¥ì†Œ ì¡°ì‚¬ (shared_preferences, secure_storage ì ìš©)

- 6ì¼ì°¨ - ë¼ìš°íŒ… ì²˜ë¦¬ ì¡°ì‚¬ & go_router ì ìš©

- 7 ~ 14ì¼ì°¨ - íƒ€ì´ë¨¸ ê´€ë ¨ ê¸°ëŠ¥, UI ì‘ì—… & API ì‚¬ìš© ê¸°ëŠ¥ ì‘ì—…

- ~~15 ~ 21ì¼ì°¨ - ë¬´ëŒ€ìŒí–¥ ì—…ë¬´ë¡œ ì¸í•´ ê±°ì˜ ì‘ì—… ì¤‘ë‹¨~~

- 22 ~ 23ì¼ì°¨ - socket ê¸°ëŠ¥ ì‘ì—…

- 24 ~ 30ì¼ì°¨ - ë¦¬íŒ©í† ë§ ë° ì•ˆë“œë¡œì´ë“œ, iOS ë¹Œë“œ í•™ìŠµ

- 31ì¼ì°¨ - êµ¬ê¸€ í”Œë ˆì´ìŠ¤í† ì–´ ë°°í¬

## Dart ì²« ë§Œë‚¨

dartëŠ” ê° ì–¸ì–´ì˜ íŠ¹ì§•ì´ ì˜ ì„ì¸ ì–¸ì–´ë¼ê³  ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤.

íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ê°€ ì• ì´ˆì— ê¸°ì¡´ ìë°”ìŠ¤í¬ë¦½íŠ¸ì— íƒ€ì…ê³¼ ê°ì²´ì§€í–¥ì ì¸ íŠ¹ì§•ì„ í™•ì¥í•˜ê³  ë‹¤ì–‘í•œ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì˜ ì¥ì ì„ ê°€ì ¸ì˜¨ë‹¤ëŠ” íŠ¹ì§•ì´ ìˆì–´ì„œ dartë„ êµ‰ì¥íˆ ìµìˆ™í•œ ëŠë‚Œì´ ë“¤ì—ˆìŠµë‹ˆë‹¤.

ë˜í•œ dartì™€ javascript ë‘ ì–¸ì–´ ëª¨ë‘ ë‹¨ì¼ ìŠ¤ë ˆë“œ ê¸°ë°˜ì´ë¼ ì´ë²¤íŠ¸ ë£¨í”„ë¥¼ í†µí•´ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ í•˜ê¸° ë•Œë¬¸ì— dartë„ ì‰½ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.

ê°œì¸ì ìœ¼ë¡œ ì–¸ì–´ í•™ìŠµì€ ì‹¤ì œë¡œ ì‚¬ìš©í•˜ë©´ì„œ ìµíˆëŠ”ê²Œ ë¹ ë¥´ê¸° ë•Œë¬¸ì— ê³µì‹ë¬¸ì„œë¥¼ í•œë²ˆ í›‘ê³  ê°„ë‹¨í•œ UI ì‘ì—…ì„ í†µí•´ ìµìˆ™í•´ì§€ëŠ” ê²ƒì´ ê°€ì¥ íš¨ìœ¨ì ì´ë¼ê³  ìƒê°í•©ë‹ˆë‹¤.

ê·¸ë˜ì„œ ì‹¤ì§ˆì ì¸ dart í•™ìŠµì€ ëª‡ì‹œê°„ ì •ë„ ë¬¸ì„œë¥¼ ì½ìœ¼ë©´ì„œ ì „ì²´ì ì¸ í‹€ì„ íŒŒì•…í•˜ê³ , ì‹¤ì œ ì‘ì—…ì„ í†µí•´ ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ë©´ì„œ ìµí˜”ìŠµë‹ˆë‹¤.

dart ê³µì‹ë¬¸ì„œì— ì½”ë”© ì»¨ë²¤ì…˜ì´ êµ‰ì¥íˆ ì˜ ì •ë¦¬ë˜ì–´ ìˆê³  vscode ë‚´ì—ì„œ ì˜ëª»ëœ ë„¤ì´ë°ì— ëŒ€í•œ ê²½ê³ ë„ ì˜ ë‚˜ì˜¤ëŠ” ì ë„ ì¥ì ì´ë¼ê³  ìƒê°í•©ë‹ˆë‹¤.

## Flutter ì²« ë§Œë‚¨

í”ŒëŸ¬í„° ë˜í•œ ê³µì‹ ë¬¸ì„œê°€ êµ‰ì¥íˆ ì˜ ì •ë¦¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤. UI ì´ì™¸ì—ë„ ìƒíƒœê´€ë¦¬, ì§ë ¬í™”, ë„¤íŠ¸ì›Œí‚¹ ë“±ë“± ë‹¤ì–‘í•œ ì£¼ì œì™€ íŒ¨í‚¤ì§€ë“¤ì´ ì˜ ì •ë¦¬ë˜ì–´ ìˆì–´ì„œ ì‹¤ì œ ì‘ì—…ì„ í•˜ë©´ì„œ ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ëŠ” ê²ƒì´ êµ‰ì¥íˆ í¸í–ˆìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ ëª¨ë°”ì¼ ê°œë°œì´ë¼ xcodeì™€ android studioë„ ê°™ì´ ì‚¬ìš©í•´ì•¼ í•˜ê³ , ëª¨ë°”ì¼ ì‹œë®¬ë ˆì´í„°ê°€ ìƒë‹¹íˆ ë¬´ê²ë‹¤ëŠ” ë‹¨ì ì´ ìˆìŠµë‹ˆë‹¤.

ê°œë°œ ìì²´ëŠ” lib í´ë” ë‚´ì—ì„œ ëŒ€ë¶€ë¶„ ì‘ì—…ì„ í•˜ì§€ë§Œ íŒ¨í‚¤ì§€ ì¶”ê°€ì‹œ iOSì™€ ì•ˆë“œë¡œì´ë“œ ì„¤ì • íŒŒì¼ë“±ì„ ìˆ˜ì •í•´ì•¼í•˜ê³ , ì¢…ì¢… xcodeì™€ android studioë¥¼ ì—´ì–´ì„œ ì‘ì—…ì„ í•´ì•¼í•˜ëŠ” ì ì´ ê¹Œë‹¤ë¡œì› ìŠµë‹ˆë‹¤.

ë˜í•œ iOSì™€ ì•ˆë“œë¡œì´ë“œ ë¹Œë“œ ê³¼ì •ì„ ê³µë¶€í•´ì•¼í•˜ê³  ì‚¬ìš©ìì˜ ê¸°ê¸°ì— ì§ì ‘ ì„¤ì¹˜í•˜ê¸° ë•Œë¬¸ì— ì¸ì¦ì„œ ë° í”„ë¡œë¹„ì €ë‹ íŒŒì¼ê³¼ ê°™ì€ ë³´ì•ˆ ì„¤ì •ì— ëŒ€í•´ì„œë„ ê³µë¶€í•´ì•¼í•˜ëŠ” ì ì´ ìˆìŠµë‹ˆë‹¤.

ê·¸ë˜ë„ ì™ ë§Œí•œ UIê°€ widgetìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆì–´ì„œ UI ì‘ì—…ì€ êµ‰ì¥íˆ ë¹ ë¥´ê²Œ ì§„í–‰í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ë ˆê³  ë¸”ëŸ­ì„ ìŒ“ë“¯ì´ UIë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆì–´ì„œ ë¦¬ì•¡íŠ¸ì˜ ì˜ ë§Œë“¤ì–´ì§„ UI ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒê³¼ ë¹„ìŠ·í•œ ëŠë‚Œì´ì—ˆìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ ê°œë°œìí’€ì´ jsì— ë¹„í•´ ë§ì´ ì ê¸° ë•Œë¬¸ì— packageê°€ ë§ì´ ë¶€ì¡±í•´ì„œ ì§ì ‘ êµ¬í˜„í•´ì•¼í•˜ëŠ” ê²½ìš°ë„ ì¡´ì¬í•˜ê³ , íŒ¨í‚¤ì§€ ë„ì…ì‹œ ë²„ê·¸ê°€ ì¡´ì¬í•˜ëŠ”ì§€, í•´ê²°ë²•ì€ ìˆëŠ”ì§€ ì¶©ë¶„íˆ ì¡°ì‚¬ë¥¼ í•´ì•¼í•˜ëŠ” ì ì´ ìˆìŠµë‹ˆë‹¤.

ê²°ë¡ ì ìœ¼ë¡œ í”ŒëŸ¬í„°ëŠ” êµ‰ì¥íˆ ë§Œì¡±ìŠ¤ëŸ¬ì› ìŠµë‹ˆë‹¤. ê¸°ì¡´ PWAì™€ ë¹„êµí–ˆì„ë•Œ ì›¹ë¸Œë¼ìš°ì €ì˜ ì œì•½ì‚¬í•­ì´ ì—†ì–´ì„œ ì„œë²„ ì—†ì´ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ë¶€ë¶„ë„ ë§ì•˜ê³ , ì‚¬ìš©ì ê²½í—˜ ë° ì„±ëŠ¥ë©´ì—ì„œë„ ë§Œì¡±ìŠ¤ëŸ¬ì› ìŠµë‹ˆë‹¤.

## UI ì‘ì—…

UI ì‘ì—…ì€ ê¸°ì¡´ PWAì—ì„œ ë¶ˆí¸í–ˆë˜ ë¶€ë¶„ì„ ê°œì„ í•˜ë©´ì„œ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.

ì´ˆê¸°ì—ëŠ” ì‹¤ì œ ê¸°ëŠ¥ì„ statefull widgetìœ¼ë¡œ ê°„ë‹¨í•œ ìƒíƒœë¥¼ í†µí•´ ëª¨í‚¹í•˜ë©´ì„œ UIë¥¼ êµ¬ì„±í•˜ë©´ì„œ í”ŒëŸ¬í„°ì— ìµìˆ™í•´ì§€ê³  BuildContextì™€ ìœ„ì ¯ íŠ¸ë¦¬ì— ëŒ€í•´ ì´í•´í•˜ëŠ”ë° ì¤‘ì ì„ ë‘ì—ˆìŠµë‹ˆë‹¤.

ë˜í•œ UIë¥¼ êµ¬ì„±í•˜ë©´ì„œ ìì£¼ ì‚¬ìš©í•˜ëŠ” ìœ„ì ¯ë“¤ì— ìµìˆ™í•´ì§€ê³  ê³µì‹ ë¬¸ì„œì˜ ìœ„ì ¯ ì¹´íƒˆë¡œê·¸ë¥¼ ì°¸ê³ í•˜ë©´ì„œ UIë¥¼ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.

ë˜í•œ ìº˜ë¦°ë”ë‚˜ ì”ë”” ê·¸ë˜í”„ì™€ ê°™ì€ ê²½ìš° ì§ì ‘ êµ¬í˜„í•˜ë©´ ì‹œê°„ì´ ë§ì´ ê±¸ë¦¬ê¸° ë•Œë¬¸ì— pub.devì—ì„œ ì•„ë˜ ë‘ê°œì˜ íŒ¨í‚¤ì§€ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤.

- [table_calendar](https://pub.dev/packages/table_calendar)
- [flutter_heatmap_calendar](https://pub.dev/packages/flutter_heatmap_calendar)

í•˜ì§€ë§Œ ì•„ë˜ì˜ flutter_heatmap_calendarëŠ” ì„¸ë¡œëª¨ë“œë¥¼ ì§€ì›í•˜ì§€ ì•Šê³  issueë¥¼ ë³´ë‹ˆ ì‘ë…„ reviewë„ í™•ì¸ì´ ì•ˆë˜ì–´ìˆì–´ì„œ ì†ŒìŠ¤ë¥¼ ì°¸ê³ í•˜ì—¬ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

flutter_vertical_heatmapë¡œ ë‹¤ë“¬ê³  ì •ë¦¬í•´ì„œ pub.devì— ë°°í¬í•´ë³´ê³  ì‹¶ì—ˆëŠ”ë° ì´ë•Œ ë‹¹ì‹œì—ëŠ” í•´ì•¼í•  ì‘ì—…ì´ ë§ì•„ì„œ ì¼ë‹¨ ë¯¸ë¤„ë‘ì—ˆìŠµë‹ˆë‹¤.

ì‘ì—…ë¬¼ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤. ë½€ëª¨ë‹­ ë””ìì¸ì— ë§ì¶˜ ìœ„ì ¯ì´ë¼ ì¢€ë” ë‹¤ë“¬ì–´ì„œ ë°°í¬ë¥¼ í•´ì•¼í•  ê²ƒ ê°™ë„¤ìš”.

![alt text](https://d2quahb2ygxiv.cloudfront.net/ef543bea9849fb3a9d6b6.png?width=500)

## ìƒíƒœê´€ë¦¬

Flutterì˜ ê³µì‹ë¬¸ì„œì—ì„œ Beyound UI/State managementê°€ êµ‰ì¥íˆ ì˜ ì •ë¦¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

StatefulWidgetë¶€í„° Provider, Bloc, Riverpod, Mobx, Redux, GetX ë“± ë‹¤ì–‘í•œ ìƒíƒœê´€ë¦¬ ë°©ì‹ì´ ìˆì§€ë§Œ, ì œê°€ ì„ íƒí•œ ê²ƒì€ Providerì˜€ìŠµë‹ˆë‹¤.

Blocê³¼ Providerì¤‘ ê³ ë¯¼ì„ ë§ì´ í–ˆëŠ”ë°, ì‘ì—… ì¸ì›ë„ 1ëª…ì´ê³ , ì—„ì²­ë‚˜ê²Œ ë³µì¡í•œ ìƒíƒœê´€ë¦¬ê°€ í•„ìš”í•˜ì§€ ì•Šë‹¤ê³  íŒë‹¨í•˜ì—¬ ìƒëŒ€ì ìœ¼ë¡œ í•™ìŠµê³¡ì„ ì´ ì ì€ Providerë¡œ ì„ íƒí–ˆìŠµë‹ˆë‹¤.

### Get_itì„ í†µí•œ DI ê°œì„ 

ê¸°ì¡´ì—ëŠ” ì•„ë˜ì™€ ê°™ì´ DIë¥¼ ì§ì ‘ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ ì—°ê´€ëœ ë°ì´í„° ê·¸ë£¹ì„ ìƒì„±í• ë•Œë§ˆë‹¤ ë ˆí¬ì§€í† ë¦¬, ë°ì´í„°ì†ŒìŠ¤, ì„œë¹„ìŠ¤ ë“±ì„ ìƒì„±í•´ì•¼í•˜ê³  ë·°ëª¨ë¸ê°„ ì˜ì¡´ì„± ì£¼ì…ì´ ìƒê¸°ë©´ ì½”ë“œê°€ ë³µì¡í•´ì§€ê³  ê´€ê³„ë¥¼ íŒŒì•…í•˜ê¸° ì ì  ì–´ë ¤ì›Œì ¸ì„œ Get_itì„ ì ìš©í–ˆìŠµë‹ˆë‹¤.

#### ê¸°ì¡´

```dart
class _MyAppState extends State<MyApp> {
  // ...
  @ovveride
  void initState() {
    super.initState();

    // ë¡œì»¬ ì €ì¥ì†Œ
    authStorage = AuthStorage();
    final SharedPreferences sharedPreferences =
      await SharedPreferences.getInstance();

    // dio ì¸ìŠ¤í„´ìŠ¤ (http í†µì‹  & auto refresh token)
    apiService = NetworkApiService(storage: authStorage);

    // ë°ì´í„° ì†ŒìŠ¤
    memberLocalDatasource = MemberLocalDatasource(storage: sharedPreferences);
    memberRemoteDatasource = MemberRemoteDataSource(apiService: apiService);

    // ë ˆí¬ì§€í† ë¦¬ (ë¡œì»¬/apiê°„ ìºì‹± & ë°ì´í„° ì²˜ë¦¬)
    memberRepository = MemberRepository(remoteDatasource: memberRemoteStorage, localDatasource: memberLocalDatasource);

    // ... ìƒëµ

    // ë·°ëª¨ë¸
    inventoryViewModel = InventoryViewModel(repository: inventoryRepository);
    memberViewModel = MemberViewModel(repository: memberRepository, inventoryViewModel: inventoryViewModel);

  }
}
```

#### Get_it ì ìš©

Get_itì„ í†µí•´ ì˜ì¡´ì„± íŒŒì¼ì„ ë¶„ë¦¬í•˜ê³ , Get_itì„ í†µí•´ ì˜ì¡´ì„±ì„ ì£¼ì…í•˜ë„ë¡ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.

```dart
// di.dart

final getIt = GetIt.instance;

Future<void> setupLocator() async {
  // local ì €ì¥ì†Œ (Hive, SharedPreferences, FlutterSecureStorage ë“±)
  await registerLocalStoragies();

  // (local)DataSource (local ì €ì¥ì†Œë¥¼ ì£¼ì…ë°›ì•„ ë°ì´í„°ë¥¼ ì²˜ë¦¬)
  registerLocalDataSource();
  // NetworkApiService (ì™¸ë¶€ ì„œë²„ì™€ í†µì‹  - authLocalDataSourceê°€ í•„ìš”í•˜ê¸° ë•Œë¬¸ì— localDataSourceë¥¼ ë¨¼ì € ë“±ë¡)
  getIt.registerLazySingleton<NetworkApiService>(() =>
      NetworkApiService(authLocalDataSource: getIt<AuthLocalDataSource>()));
  // (remote)DataSource (apiServicesë¥¼ ì£¼ì…ë°›ì•„ ì™¸ë¶€ ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ì²˜ë¦¬)
  registerRemoteDataSource();

  // Repository (dataSourcesë¥¼ ì´ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ì²˜ë¦¬)
  registerRepository();

  // ViewModel (repositoriesë¥¼ ì£¼ì…ë°›ì•„ viewì—ì„œ ì‚¬ìš©í•  ë°ì´í„°ë¥¼ ì²˜ë¦¬)
  registerViewModels();
}

// local ì €ì¥ì†Œ ë“±ë¡
Future<void> registerLocalStoragies() async {
  // ...
  // SharedPreferences (ê°„ë‹¨í•œ ì„¤ì • ê°™ì€ key-value ìŒì„ ì €ì¥í•˜ëŠ” ìš©ë„)
  final SharedPreferences sharedPreferences =
      await SharedPreferences.getInstance();
  getIt.registerLazySingleton<SharedPreferences>(() => sharedPreferences);

  // FlutterSecureStorage (ë³´ì•ˆì´ í•„ìš”í•œ ë°ì´í„° (í† í°, ê³„ì • ì •ë³´ ë“±)ë¥¼ ì €ì¥í•˜ëŠ” ìš©ë„)
  getIt.registerLazySingleton<FlutterSecureStorage>(
      () => const FlutterSecureStorage());
}

// LocalDataSource
void registerLocalDataSource() {
  // ...
  getIt.registerLazySingleton<MemberLocalDataSource>(
      () => MemberLocalDataSourceImpl(getIt<SharedPreferences>()));
}

// RemoteDataSource
void registerRemoteDataSource() {
  // ...
  getIt.registerLazySingleton<MemberRemoteDataSource>(
      () => MemberRemoteDataSourceImpl(apiService: getIt<NetworkApiService>()));
}

// Repository
void registerRepository() {
  // ...
  getIt.registerLazySingleton<MemberRepository>(
    () => MemberRepository(
      localDataSource: getIt<MemberLocalDataSource>(),
      remoteDataSource: getIt<MemberRemoteDataSource>(),
    ),
  );
}

// View Model
void registerViewModels() {
  // ...
  getIt.registerLazySingleton<MemberViewModel>(
    () => MemberViewModel(repository: getIt<MemberRepository>()),
  );
}
```

```dart
// main.dart
Future<void> main() async {
  // ...
  await setupLocator();

  runApp(
    const MyApp(),
  );
}


class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MultiProvider(
      providers: [
        // ...
        ChangeNotifierProvider(create: (_) => getIt<MemberViewModel>()),
      ],
      child: Builder(
        builder: (context) {
          final appRouter = AppRouter(
              appViewModel: getIt<AppViewModel>(),
              authViewModel: getIt<AuthViewModel>());
          final goRouter = appRouter.router;

          // ...
        },
      ),
    );
  }
}
```

## API ì²˜ë¦¬

ì²˜ìŒì—ëŠ” http íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í–ˆëŠ”ë° Interceptor ì²˜ë¦¬ë¥¼ ìœ„í•´ dio íŒ¨í‚¤ì§€ë¡œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.

ìœ„ì˜ Get_it ì ìš© ì˜ˆì œì½”ë“œì—ì„œ apiServiceì— authLocalDataSourceë¥¼ ì£¼ì…ë°›ì•„ì„œ ëª¨ë“  ìš”ì²­ì— jwtTokenì„ ì£¼ì…í•˜ê³ , ë¦¬í”„ë ˆì‹œ í† í°ì„ í†µí•´ í† í° ë§Œë£Œì‹œ ì¬ë°œê¸‰ í›„ ì¬ìš”ì²­í•˜ëŠ” ë¡œì§ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

```dart
class AuthInterceptor extends Interceptor {
  final AuthLocalDataSource authLocalDataSource;
  final Future<AuthTokens> Function(String rToken) refreshToken;

  AuthInterceptor({
    required this.authLocalDataSource,
    required this.refreshToken,
  });

  @override
  void onRequest(
      RequestOptions options, RequestInterceptorHandler handler) async {
    final tokens = await authLocalDataSource.getTokens();

    if (tokens != null) {
      options.headers['Authorization'] = 'Bearer ${tokens.accessToken}';
    }
    super.onRequest(options, handler);
  }

  @override
  void onError(DioException err, ErrorInterceptorHandler handler) async {
    if (err.response?.statusCode == 401) {
      if (err.requestOptions.extra['retry'] == true) {
        // ì´ë¯¸ ì¬ìš”ì²­í•œ ê²½ìš° ë” ì´ìƒ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ
        return handler.next(err);
      }

      AuthTokens? tokens = await authLocalDataSource.getTokens();
      String? rToken = tokens?.refreshToken;
      if (rToken == null) {
        // refreshTokenì´ ì—†ëŠ” ê²½ìš° ë” ì´ìƒ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ
        return handler.next(err);
      }

      final AuthTokens newTokens = await refreshToken(rToken);

      // ìš”ì²­ ì¬ì‹œë„
      RequestOptions updatedOptions = err.requestOptions.copyWith(
        headers: {
          ...err.requestOptions.headers,
          'Authorization': 'Bearer ${newTokens.accessToken}',
          "retry": true,
        },
      );
      try {
        final response = await Dio().fetch(updatedOptions);
        handler.resolve(response);
      } catch (e) {
        handler.reject(err);
      }
    } else {
      super.onError(err, handler);
    }
  }
}
```

### í† í° ë¦¬í”„ë ˆì‹œ ë¡œì§ ìƒí˜¸ì°¸ì¡° ì²˜ë¦¬

ê¸°ì¡´ì— autoRemoteDatasourceì—ì„œ refreshToken ë¡œì§ì„ ì²˜ë¦¬í•˜ë‹¤ê°€ ì•„ë˜ì˜ ìƒí˜¸ì°¸ì¡°ê°€ ë°œìƒí•˜ì—¬ refreshToken ë¡œì§ë§Œ NetworkApiServiceì— ë¶„ë¦¬í•˜ì—¬ ì¸í„°ì…‰í„°ì— ì „ë‹¬í–ˆìŠµë‹ˆë‹¤.

`authRepository` \<- `authRemoteDatasource` \<- **`networkApiService`**

**`networkApiService`** \<- `authRepository`

```dart
class NetworkApiService extends BaseApiServices {
  final Dio _dio = Dio();
  final String _nestApiEndpoint = dotenv.env['NEST_API_ENDPOINT']!;
  final AuthLocalDataSource authLocalDataSource;

  NetworkApiService({required this.authLocalDataSource}) {
    _dio.interceptors.add(AuthInterceptor(
      authLocalDataSource: authLocalDataSource,
      refreshToken: refreshToken,
    ));
  }

  @override
  Future<dynamic> getGetApiResponse(String url) async {
    // ...
  }

  @override
  Future<dynamic> getPostApiResponse(String url, dynamic data) async {
    // ...
  }

  @override
  Future<dynamic> getPatchApiResponse(String url, dynamic data) async {
    // ...
  }

  @override
  Future<dynamic> getDeleteApiResponse(String url, dynamic data) async {
    // ...
  }

  Future<AuthTokens> refreshToken(String rToken) async {
    // ...
  }

  void _handleDioError(DioException dioError) {
    // ...
  }
}
```

ë˜í•œ Get_it ì ìš© ì˜ˆì œì½”ë“œì˜ setupLocator()ë¥¼ ë³´ë©´ apiServiceì´ì „ì— authLocalDataSourceë¥¼ ìœ„í•´ localDataSourceë¥¼ ë¨¼ì € ë“±ë¡í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì‘ë‹µ ë°ì´í„° ì§ë ¬í™”

ì§ë ¬í™” ë˜í•œ [ê³µì‹ë¬¸ì„œ](https://docs.flutter.dev/data-and-backend/serialization/json)ë¥¼ ì°¸ê³ í•˜ì—¬ json_serializable íŒ¨í‚¤ì§€ë¥¼ í†µí•´ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤.

ë˜í•œ api ì‘ë‹µì´ í•­ìƒ ë™ì¼í•œ êµ¬ì¡°ë¡œ í†µì¼í–ˆê¸° ë•Œë¬¸ì— api ì‘ë‹µì„ BaseApiResponse í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

```dart
import 'package:json_annotation/json_annotation.dart';

part 'base_api_response.g.dart';

@JsonSerializable(
  genericArgumentFactories: true,
)
class BaseApiResponse<T> {
  final String status; // success | error
  final String? message;
  final String? error;
  final T? data;

  BaseApiResponse({
    required this.status,
    this.data,
    this.error,
    this.message,
  });

  factory BaseApiResponse.fromJson(
          Map<String, dynamic> json, T Function(Object? json) fromJsonT) =>
      _$BaseApiResponseFromJson(json, fromJsonT);

  Map<String, dynamic> toJson(Object? Function(T value) toJsonT) =>
      _$BaseApiResponseToJson(this, toJsonT);
}
```

#### ì‚¬ìš© ì˜ˆì œ

**ì‘ë‹µì˜ dataì— ë‹´ê¸¸ ëª¨ë¸ì„ ìƒì„±**

```dart
import 'package:json_annotation/json_annotation.dart';
import 'package:pomodak/models/domain/account_model.dart';

part 'login_response.g.dart';

@JsonSerializable(createToJson: false)
class LoginResponse {
  AccountModel account;
  @JsonKey(name: 'access_token')
  String accessToken;
  @JsonKey(name: 'refresh_token')
  String refreshToken;
  @JsonKey(name: 'expires_in')
  int expiresIn;

  LoginResponse({
    required this.account,
    required this.accessToken,
    required this.refreshToken,
    required this.expiresIn,
  });

  factory LoginResponse.fromJson(Map<String, dynamic> json) =>
      _$LoginResponseFromJson(json);
}
```

**api í˜¸ì¶œ**

BaseApiResponseì˜ ë‘ë²ˆì§¸ ì¸ìì— ì œë„ˆë¦­ Tì— ëŒ€í•œ fromJson í•¨ìˆ˜ë¥¼ ë„˜ê²¨ì£¼ë©´ì„œ ì‚¬ìš©í•©ë‹ˆë‹¤.

```dart
// auth_remote_datasource.dart

// ...
  @override
  Future<BaseApiResponse<LoginResponse>> emailLoginApi({
    required String email,
    required String password,
  }) async {
    try {
      Map body = {
        "email": email,
        "password": password,
      };
      Map<String, dynamic> responseJson = await apiService.getPostApiResponse(
        '$_nestApiEndpoint/auth/email/login',
        body,
      );
      BaseApiResponse<LoginResponse> response = BaseApiResponse.fromJson(
        responseJson,
        (json) => LoginResponse.fromJson(json as Map<String, dynamic>),
      );

      return response;
    } catch (e) {
      rethrow;
    }
  }
```

### ì‘ë‹µì˜ data í˜•íƒœê°€ ë§¤ë²ˆ ë‹¤ë¥¸ ê²½ìš° (all ëœë¤ íš¨ê³¼ ì•„ì´í…œ ì‚¬ìš©)

ë½€ëª¨ë‹­ì— ì‚¬ìš©ëœ apiëŠ” ëŒ€ë¶€ë¶„ ì •í•´ì§„ í˜•íƒœë¡œ ì‘ë‹µì´ ì˜¤ì§€ë§Œ ë½‘ê¸° apiì˜ ê²½ìš° ê²°ê³¼ì— ë”°ë¼ Tì˜ í˜•íƒœê°€ ë‹¤ë¥¸ ê²½ìš°ê°€ ì¡´ì¬í•©ë‹ˆë‹¤.

ê¸°ì¡´ì—ëŠ” ìºë¦­í„° ë½‘ê¸°, íŒ”ë ˆíŠ¸ ë½‘ê¸° ... ì´ëŸ°ì‹ìœ¼ë¡œ ê°ê°ì˜ apië¥¼ ë§Œë“¤ì–´ì„œ ì²˜ë¦¬í•´ì„œ ì•„ì´í…œ ì‚¬ìš©ì‹œ í•´ë‹¹ ì•„ì´í…œ íš¨ê³¼ì— ë§ëŠ” ê²°ê³¼(ìºë¦­í„°ë§Œ íšë“, í¬ì¸íŠ¸ë§Œ íšë“)ë§Œ ì‘ë‹µí–ˆì—ˆìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ ìœ„ ë°©ì‹ì€ ìœ ì—°ì„±ì´ ì ê³  í™•ì¥ì„±ë„ ë–¨ì–´ì§€ê¸° ë•Œë¬¸ì— `ì•„ì´í…œ ì‚¬ìš©`ì´ë¼ëŠ” í•˜ë‚˜ì˜ apië¡œ í†µì¼í•˜ê³ , ì‘ë‹µì˜ data í˜•íƒœì— ë”°ë¼ ë‹¤ë¥¸ ëª¨ë¸ì„ ì‚¬ìš©í•˜ë„ë¡ ë°±ì—”ë“œ ë¡œì§ì„ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.

íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ëŠ” ìœ ë‹ˆì˜¨ íƒ€ì…ì„ ì§€ì›í•˜ê¸° ë•Œë¬¸ì— ìœ ë‹ˆì˜¨ íƒ€ì…ìœ¼ë¡œ ë°›ì•„ì„œ result í•„ë“œì— ë”°ë¼ êµ¬ë¶„í–ˆì§€ë§Œ, ë‹¤íŠ¸ëŠ” ìœ ë‹ˆì˜¨ íƒ€ì…ì„ ì§€ì›í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ë‹¤ìŒê³¼ ê°™ì´ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤.

```dart
// transaction_remote_datasource.dart
// ...
  @override
  Future<dynamic> consumeItemApi(String inventoryId) async {
    try {
      Map<String, dynamic> responseJson = await apiService.getPostApiResponse(
        '$_springApiEndpoint/v2/item-inventory/$inventoryId',
        {},
      );
      final String result = responseJson["data"]["result"];
      late final BaseApiResponse<dynamic> response;
      switch (result) {
        case consumableItemAcquisition:
          response = BaseApiResponse.fromJson(
            responseJson,
            (json) => ConsumableItemAcquisition.fromJson(
                json as Map<String, dynamic>),
          );
          break;
        case characterAcquisition:
          response = BaseApiResponse.fromJson(
            responseJson,
            (json) =>
                CharacterAcquisition.fromJson(json as Map<String, dynamic>),
          );
          break;
        case paletteAcquisition:
          response = BaseApiResponse.fromJson(
            responseJson,
            (json) => PaletteAcquisition.fromJson(json as Map<String, dynamic>),
          );
          break;
        case pointAcquisition:
          response = BaseApiResponse.fromJson(
            responseJson,
            (json) => PointAcquisition.fromJson(json as Map<String, dynamic>),
          );
          break;
        default:
          throw Exception('Unknown result type: $result');
      }

      var data = response.data;
      return data;
    } catch (e) {
      rethrow;
    }
  }
```

dartëŠ” isë¥¼ í†µí•´ ëŸ°íƒ€ì„ì—ì„œ íƒ€ì…ì„ ì²´í¬í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì‘ë‹µ ë°ì´í„°ì— ëŒ€í•œ ì²˜ë¦¬ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```dart
// transaction_view_model.dart

// ...
  // ConsumableItemAcquisition, CharacterAcquisition, PaletteAcuisition, PointAcquisition
  // ìœ„ íƒ€ì…ì²´í‚¹ í•„ìš”
  Future<dynamic> consumeItem(
      {required String inventoryId, bool isFood = false}) async {
    if (_isLoadingConsumeItem) return;
    _setLoadingState('consumeItem', isLoading: true);
    try {
      _setError('consumeItem');
      var result = await repository.consumeItem(inventoryId);

      if (result is ConsumableItemAcquisition) {
        memberViewModel.loadConsumableInventory();
      } else if (result is CharacterAcquisition) {
        memberViewModel.loadCharacterInventory();
      } else if (result is PaletteAcquisition) {
        memberViewModel.loadPalette();
      } else if (result is PointAcquisition) {
        memberViewModel.loadMember(forceUpdate: true);
      }

      // ìŒì‹ ì•„ì´í…œìœ¼ë¡œ ì‚¬ìš©í•œ ê²½ìš°ì™€ ì‚¬ìš©ì•„ì´í…œìœ¼ë¡œ ì‚¬ìš©í•œ ê²½ìš°ì˜ ìˆ˜ëŸ‰ ê°±ì‹ 
      if (isFood) {
        memberViewModel.loadFoodInventory();
      } else {
        if (result is ConsumableItemAcquisition) {
          memberViewModel.loadConsumableInventory();
        }
      }

      return result;
    } catch (e) {
      _handleError('consumeItem', e);
    } finally {
      _setLoadingState('consumeItem', isLoading: false);
    }
  }
```

## ë§ˆë¬´ë¦¬

ì‹¤ì œ ì½”ë“œë¥¼ ë„£ìœ¼ë©´ì„œ ì‘ì„±í•˜ë‹¤ë³´ë‹ˆ ìƒê°ë³´ë‹¤ ê¸¸ì–´ì ¸ì„œ 2í¸ìœ¼ë¡œ ë‚˜ëˆ ì„œ ì‘ì„±í•˜ê² ìŠµë‹ˆë‹¤.

2í¸ì—ì„œ ë¼ìš°íŒ… ì²˜ë¦¬, íƒ€ì´ë¨¸ ê´€ë ¨ ì²˜ë¦¬, ì†Œì¼“ í†µì‹ ì— ëŒ€í•´ ì •ë¦¬í•˜ê² ìŠµë‹ˆë‹¤.
